-- Query 1
-- 1a. Query Before (EXPLAIN):
EXPLAIN SELECT P_CODE, P_PRICE
FROM PRODUCT
WHERE P_PRICE >= (SELECT AVG(P_PRICE) FROM PRODUCT);

-- 1c. Query After (EXPLAIN):
EXPLAIN SELECT P_CODE, P_PRICE
FROM PRODUCT P
JOIN (SELECT AVG(P_PRICE) AS AVG_PRICE FROM PRODUCT) AS AVG_TABLE
WHERE P.P_PRICE >= AVG_TABLE.AVG_PRICE;



-- Query 2
-- 2a. Query Before (EXPLAIN):
EXPLAIN SELECT P_CODE, SUM(LINE_UNITS)
FROM LINE
GROUP BY P_CODE
HAVING SUM(LINE_UNITS) > (SELECT MAX(LINE_UNITS) FROM LINE);

-- 2c. Query After (EXPLAIN):
EXPLAIN SELECT P_CODE, SUM(LINE_UNITS)
FROM LINE
JOIN (
  SELECT P_CODE, MAX(LINE_UNITS) AS MAX_UNITS
  FROM LINE
  GROUP BY P_CODE
) AS MAX_UNITS_TABLE ON LINE.P_CODE = MAX_UNITS_TABLE.P_CODE
GROUP BY P_CODE
HAVING SUM(LINE_UNITS) > MAX_UNITS_TABLE.MAX_UNITS;



-- Query 3
-- 3a. Query Before (EXPLAIN):
EXPLAIN SELECT P_CODE, P_QOH * P_PRICE
FROM PRODUCT
WHERE P_QOH * P_PRICE > (SELECT AVG(P_QOH*P_PRICE) FROM PRODUCT);

-- 3c. Query After (EXPLAIN):
EXPLAIN SELECT P_CODE, P_QOH * P_PRICE
FROM PRODUCT P
JOIN (
  SELECT AVG(P_QOH * P_PRICE) AS AVG_QOH_PRICE
  FROM PRODUCT
) AS AVG_TABLE ON P.P_QOH * P.P_PRICE > AVG_TABLE.AVG_QOH_PRICE;



-- Query 4
-- 4a. Query Before (EXPLAIN):
EXPLAIN SELECT V_CODE, V_NAME, V_STATE
FROM VENDOR
WHERE V_STATE = 'TN'
ORDER BY V_NAME;

-- 4c. Query After (EXPLAIN):
EXPLAIN SELECT V_CODE, V_NAME, V_STATE
FROM VENDOR
WHERE V_STATE = 'TN'
ORDER BY V_NAME;



-- Query 5
-- 5a. Query Before (EXPLAIN):
EXPLAIN SELECT P_CODE, P_DESCRIPT, P_PRICE, P.V_CODE, V_STATE
FROM PRODUCT P, VENDOR V
WHERE P.V_CODE = V.V_CODE
AND V_STATE = 'TN'
AND V_AREACODE = '615'
ORDER BY P_PRICE;

-- 5c. Query After (EXPLAIN):
EXPLAIN SELECT P_CODE, P_DESCRIPT, P_PRICE, P.V_CODE, V_STATE
FROM PRODUCT P
JOIN VENDOR V ON P.V_CODE = V.V_CODE
WHERE V_STATE = 'TN'
AND V_AREACODE = '615'
ORDER BY P_PRICE;



-- Query 6
-- 6a. Query with Joins in One Order (EXPLAIN):
EXPLAIN SELECT *
FROM INVOICE I
INNER JOIN CUSTOMER C ON I.CUS_CODE = C.CUS_CODE
INNER JOIN LINE L ON I.INV_NUMBER = L.INV_NUMBER
INNER JOIN PRODUCT P ON L.P_CODE = P.P_CODE
WHERE C.CUS_BALANCE > 500
AND P.P_PRICE > 50
ORDER BY I.INV_NUMBER;

-- 6b. Query in a Different Order from 6a (EXPLAIN):
EXPLAIN SELECT *
FROM PRODUCT P
INNER JOIN LINE L ON P.P_CODE = L.P_CODE
INNER JOIN INVOICE I ON L.INV_NUMBER = I.INV_NUMBER
INNER JOIN CUSTOMER C ON I.CUS_CODE = C.CUS_CODE
WHERE C.CUS_BALANCE > 500
AND P.P_PRICE > 50
ORDER BY I.INV_NUMBER;

